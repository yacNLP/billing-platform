enum BillingInterval {
  DAY
  WEEK
  MONTH
  YEAR
}

enum Role {
  ADMIN
  USER
}
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Customer {
  id        Int      @id @default(autoincrement())
  name      String
  email     String

  tenantId  Int
  tenant    Tenant   @relation(fields: [tenantId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, email])
  @@index([tenantId])
}


model Product {
  id                Int      @id @default(autoincrement())
  name              String
  sku               String
  description       String?  @db.Text
  priceCents        Int
  currency          String   @default("EUR")
  taxRate           Decimal  @default(0.20) @db.Decimal(5, 4)
  isActive          Boolean  @default(true)
  stock             Int      @default(0)
  lowStockThreshold Int      @default(0)

  tenantId          Int
  tenant            Tenant   @relation(fields: [tenantId], references: [id])

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  plans             Plan[]

  @@unique([tenantId, sku])
  @@index([tenantId])
  @@index([name])
  @@index([isActive])
}


model Plan {
  id             Int              @id @default(autoincrement())
  code           String
  name           String
  description    String?

  productId      Int
  product        Product          @relation(fields: [productId], references: [id])

  tenantId       Int
  tenant         Tenant           @relation(fields: [tenantId], references: [id])

  amount         Int
  currency       String           @db.VarChar(3)

  interval       BillingInterval
  intervalCount  Int              @default(1)
  trialDays      Int              @default(0)

  active         Boolean          @default(true)
  metadata       Json?

  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  deletedAt      DateTime?

  @@unique([tenantId, code])
  @@index([tenantId])
  @@index([productId])
  @@index([active])
}


model Tenant {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())

  users     User[]
  customers Customer[]
  products  Product[]
  plans     Plan[]
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      Role   @default(USER)

  tenantId  Int
  tenant    Tenant   @relation(fields: [tenantId], references: [id])

  createdAt DateTime @default(now())
}
